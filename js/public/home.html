<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <meta name="format-detection" content="telephone=no" />
  <link rel="icon" href="images/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="css/homecss.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css">
  <title>HOME</title>

  <!-- Bootstrap -->
  <link href="css/bootstrap.css" rel="stylesheet">

  <!-- Links -->
  <link rel="stylesheet" href="css/camera.css">
  <link rel="stylesheet" href="css/search.css">
  <link rel="stylesheet" href="css/google-map.css">
  <link rel="stylesheet" href="css/owl-carousel.css">


  <!--JS-->
  <script src="js/jquery.js"></script>
  <script src="js/jquery-migrate-1.2.1.min.js"></script>
  <script src="js/rd-smoothscroll.min.js"></script>


  <!--[if lt IE 9]>
    <div style=' clear: both; text-align:center; position: relative;'>
        <a href="http://windows.microsoft.com/en-US/internet-explorer/..">
            <img src="images/ie8-panel/warning_bar_0000_us.jpg" border="0" height="42" width="820"
                 alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today."/>
        </a>
    </div>
    <script src="js/html5shiv.js"></script>
    <![endif]-->
  <script src='js/device.min.js'></script>
</head>

<body>
  <div class="page">
    <!--========================================================
                            HEADER
  =========================================================-->
    <header>
      <div class="container top-sect">
        <div class="navbar-header">
          <h1 class="navbar-brand">
            <a data-type='rd-navbar-brand' href="./">
              <p id="denominacion"></p>
            </a>
          </h1>
          <a class="search-form_toggle" href="#"></a>
        </div>

        <div class="help-box text-right">
          <p>Teléfono</p>
          <a id="telefono" href="callto:#"></a>
          <small style="font-size: 14px; color: #666;">
            <span class="horario" style="font-weight: bold;">Horario:</span>
            <small><span id="horarioAtencion" class="horario" style="color: #666; font-size: 14px; font-family: Arial, sans-serif;"></span></small>
          </small>
        </div>
      </div>

      <div id="stuck_container" class="stuck_container">
        <div class="container">
          <nav class="navbar navbar-default navbar-static-top pull-left">
            <div class="">
              <ul class="nav navbar-nav sf-menu sf-js-enabled sf-arrows" data-type="navbar">
                <li style="list-style: none;" class="active">
                  <a href="#" onclick="irAHome()">INICIO</a>
              </li>
                <li style="list-style: none;">
                  <a href="index.html">LISTA EMPRESAS</a>
                </li>
              </ul>
            </div>
          </nav>
          <form id="searchForm" class="search-form" method="GET" accept-charset="utf-8">
            <label class="search-form_label">
                <input id="searchInput" class="search-form_input" type="text" name="buscar" autocomplete="off" placeholder="Ingrese Texto" />
                <span class="search-form_liveout"></span>
            </label>
            <button id="searchButton" class="search-form_submit fa-search" type="button"></button>
        </form>
        
        <script>
            function redirectToSearch() {
                // Obtener el valor del campo de búsqueda
                var busqueda = document.getElementById('searchInput').value.trim();
        
                // Obtener el ID de la empresa de la URL actual
                var urlParams = new URLSearchParams(window.location.search);
                var idEmpresa = urlParams.get('id');
        
                // Construir la URL de redirección
                var url = 'buscador.html?id=' + idEmpresa;
        
                // Verificar si el campo de búsqueda no está vacío
                if (busqueda !== '') {
                    // Agregar el término de búsqueda a la URL
                    url += '&buscar=' + encodeURIComponent(busqueda);
                }
        
                // Redirigir manualmente a la URL compuesta
                window.location.href = url;
            }
        
            document.getElementById('searchButton').addEventListener('click', redirectToSearch);
        
            document.getElementById('searchForm').addEventListener('submit', function(event) {
                event.preventDefault(); // Evitar el envío del formulario predeterminado
                redirectToSearch(); // Redirigir al hacer clic en el botón de búsqueda
            });
          </script>
          
        </div>
      </div>
    </header>

    <!--========================================================
                            CONTENT
  =========================================================-->
  <main>
    <div>
      <section class="well well1 well1_ins1">
        <!-- Aquí agregamos el div del carrousel -->
        <div class="owl-carousel owl-theme" id="carouselNoticias"></div>
      </section>
  
      <section class="well well2 wow fadeIn bg1" data-wow-duration='3s'>
        <div class="container">
          <h2 class="txt-pr">
            Quienes Somos
          </h2>
          <div class="row">
            <div class="col">
              <p id="quienesSomos" style="text-align:justify">
  
              </p>
            </div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!--========================================================
                            FOOTER
  =========================================================-->
  <footer class="top-border">
    <section class="well well2 wow fadeIn  bg1" data-wow-duration='3s'>
      <div class="container">
        <h2 class="txt-pr">
          Donde estamos
        </h2>
      </div>
    </section>
    <div id="map" style="height: 400px;"></div>

    <script>
      function iniciarMap(latitud, longitud) {
        var coord = { lat: latitud, lng: longitud };
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 15,
          center: coord
        });
        var marker = new google.maps.Marker({
          position: coord,
          map: map
        });
      }
    </script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSKBFrnFlCGZy5RTO4sShdOOCfYkWFlsc&callback=iniciarMap"
      async defer></script>

    <section class="well1">
      <div class="container">
        <p class="rights">
          <span id="denominacionEmpresaFooter"></span> &#169; <span id="copyright-year"></span>
          <a href="index-5.html">Privacy Policy</a>
          <!-- {%FOOTER_LINK} -->
        </p>
      </div>
    </section>
  </footer>
  </div>


  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="js/jquery.js"></script>
  <script src="js/jquery-migrate-1.2.1.min.js"></script>
  <script src="js/rd-smoothscroll.min.js"></script>
  <script src="js/device.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/tm-scripts.js"></script>
  
  
  <!-- </script> -->

  <script>
    function obtenerParametroDeURL(parametro) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(parametro);
    }
  
    const idEmpresa = obtenerParametroDeURL('id');
  
    fetch(`/empresas/${idEmpresa}`)
      .then(response => response.json())
      .then(data => {
        document.getElementById('denominacion').textContent = data.denominacion || 'Empresa no encontrada';
        document.getElementById('denominacionEmpresaFooter').textContent = data.denominacion || 'Empresa no encontrada'; // Modificación aquí
        document.getElementById('quienesSomos').textContent = data.quienesSomos || 'Descripción no disponible';
        document.getElementById('telefono').textContent = data.telefono || 'Teléfono no disponible';
        document.getElementById('horarioAtencion').textContent = data.horarioAtencion || 'Horario no disponible';

        // Llama a la función iniciarMap con las coordenadas de la empresa
        iniciarMap(parseFloat(data.latitud), parseFloat(data.longitud));
      })
      .catch(error => console.error('Error al obtener la información de la empresa:', error));

    // Función para obtener los datos de la noticia y redirigir al detalle
    function irADetalle(idNoticia) {
      const idEmpresa = obtenerParametroDeURL('id');
      window.location.href = `detalle.html?idEmpresa=${idEmpresa}&idNoticia=${idNoticia}`;
    }
  </script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Seleccionar todos los elementos con la clase 'titulo-noticia'
        const titulosNoticia = document.querySelectorAll('.titulo-noticia');
  
        // Agregar un controlador de eventos click a cada título de noticia
        titulosNoticia.forEach(titulo => {
          titulo.addEventListener('click', function() {
            // Obtener el ID de la noticia del atributo de datos 'data-id'
            const idNoticia = this.dataset.id;
  
            // Redirigir a la página de detalle con el ID de la noticia
            irADetalle(idNoticia);
          });
        });
      });
  
      // Función para redirigir a la página de detalle con el ID de la noticia
      // function irADetalle(idNoticia) {
      //   // Obtener el ID de la empresa de la URL actual
      //   const idEmpresa = obtenerParametroDeURL('id');
      //   const idNoticia = obtenerParametroDeURL('id');
  
      //   // Redirigir a la página de detalle con los parámetros necesarios
      //   window.location.href = `detalle.html?idEmpresa=${idEmpresa}&idNoticia=${idNoticia}`;
      // }
    </script>

<!-- Incluye jQuery (necesario para Owl Carousel) -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Incluye el JavaScript de Owl Carousel -->
<script src="//cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
<!-- Configura el Owl Carousel -->
<!-- Configurar el carrusel una vez que se han agregado todos los elementos -->
<script>
  // Hacer la solicitud de las noticias específicas de la empresa
  fetch(`/empresas/${idEmpresa}/noticias`)
  .then(response => response.json())
  .then(noticias => {
    noticias.sort((a, b) => new Date(b.FechaPublicacion) - new Date(a.FechaPublicacion));
      
    // Tomar solo las últimas 5 noticias, si hay más de 5
    const ultimasNoticias = noticias.slice(0, 5);

    // Actualizar el carrusel con las últimas noticias
    ultimasNoticias.forEach(noticia => {
      actualizarCarrusel(noticia);
    });

    // Configurar el carrusel una vez que se han agregado todos los elementos
    configurarCarrusel();
  })
  .catch(error => console.error('Error al obtener noticias:', error));

  function actualizarCarrusel(noticia) {
    const carouselContainer = document.getElementById('carouselNoticias');
    const item = document.createElement('div');
    item.classList.add('item');
    item.innerHTML = `
        <img src="${noticia.ImagenNoticia}" alt="${noticia.TituloNoticia}">
        <div class="title">
          <div class="jumbotron jumbotron1">
            <em><a href="#" onclick="irADetalle(${noticia.id})">${noticia.TituloNoticia}</a></em>
            <div class="wrap">
              <p>${noticia.ResumenNoticia}</p>
              <a href="#" onclick="irADetalle(${noticia.id})">Leer más</a>
            </div>
          </div>
        </div>
      `;
      carouselContainer.appendChild(item);
  }

function configurarCarrusel() {
  $(".owl-carousel").owlCarousel({
    items: 1,
    loop: true,
    autoplay: true,
    autoplayTimeout: 5000, // Cambia cada 5 segundos
    autoplayHoverPause: true // Pausa al pasar el mouse sobre el carrusel
    // Otros ajustes de Owl Carousel si los necesitas
  });

  // Eliminar la última noticia del carrusel
  if (owlCarousel) {
    const numItems = owlCarousel.items().length - 1;
    if (numItems > 5) {
      for (let i = 0; i < numItems - 5; i++) {
        owlCarousel.remove(0); // Eliminar las noticias más antiguas
      }
    }
  }
}
</script>
<script>
  function irAHome() {
      // Obtener el ID de la empresa de la URL actual
      const idEmpresa = obtenerParametroDeURL('id');
      
      // Construir la URL de redirección a home.html con el ID de la empresa como parámetro
      const url = `home.html?id=${idEmpresa}`;
      
      // Redirigir a la página home.html con el ID de la empresa en la URL
      window.location.href = url;
  }
</script>
</body>
</html>
